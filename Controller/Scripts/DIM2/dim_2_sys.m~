clear; clc;

% global xi wn J A;

xi = 0.7;
wn = 0.1;
J = 1.0;
A = 1 / J;
alpha = 400.0;

kd = (2 * xi * wn + alpha * wn);
kp = (wn ^ 2 + 2 * xi * wn ^ 2 * alpha);
ki = (alpha * wn ^ 2);

kp = 10.0;
ki = 0.01;
kd = 40.0;

K = [kp ki kd]

%% TR analysis

NUM = [kd kp ki];
DEN = [1, kd, kp, ki];
sys = tf(NUM, DEN);
z = roots(NUM');
p = roots(DEN');

figure(1); clf; nyquist(sys); grid on;
figure(2); clf; margin(sys); grid on;
figure(3); clf; step(sys); grid on;
figure(4); clf; impulse(sys); grid on;
figure(5); clf; nichols(sys); grid on;
[Gm, Pm, Wcg, Wcp] = margin(sys);
delay = (Pm) / rad2deg(Wcp)
stepinfo(sys)

%% Sensitivity analysis

NUM = [1 0 0 0];
DEN = [1 A * kd A * kp A * ki];
sys = tf(NUM, DEN);
figure(6); clf; margin(sys); grid on;
sens_sys = tf();


%% Open Loop analysis
NUM = [kd kp ki];
DEN = [1 0]


